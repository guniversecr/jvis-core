# JVIS Agent Configuration Schema
# Version: 1.0.0
# All agent YAML configs must conform to this schema

$schema: "http://json-schema.org/draft-07/schema#"
title: JVIS Agent Configuration
description: Schema for parametric agent definition

type: object
required:
  - id
  - name
  - title
  - pack
  - persona
  - commands

properties:
  # === Identity ===
  id:
    type: string
    pattern: "^[a-z][a-z0-9-]*$"
    description: Agent ID (lowercase, no spaces), used in /command
    examples: ["dev", "qa", "pm", "scrum-master"]

  name:
    type: string
    description: Human-readable agent name (persona name)
    examples: ["James", "Quinn", "Alice"]

  title:
    type: string
    description: Agent's job title
    examples: ["Full Stack Developer", "Test Architect", "Product Manager"]

  icon:
    type: string
    description: Emoji icon for the agent
    default: "ðŸ¤–"

  whenToUse:
    type: string
    description: When to invoke this agent (shown in help)

  # === Availability ===
  pack:
    type: string
    enum: ["core", "marketing", "mobile", "data", "security", "cloud", "integrations", "devops", "specialty"]
    description: Extension pack this agent belongs to
    default: "core"

  enabled:
    type: boolean
    description: Whether agent is currently active
    default: true

  status:
    type: string
    enum: ["active", "draft"]
    description: Agent maturity status. Active agents are generated by default; draft agents are skipped unless --include-drafts is used.
    default: "draft"

  # === Persona ===
  persona:
    type: object
    required: ["role", "style", "identity", "focus"]
    properties:
      role:
        type: string
        description: The agent's primary role
      style:
        type: string
        description: Communication and working style
      identity:
        type: string
        description: How the agent sees itself
      focus:
        type: string
        description: What the agent prioritizes
      core_principles:
        type: array
        items:
          type: string
        description: Key operating principles
      integrations:
        type: object
        description: Integrations with other systems (e.g., finance)

  # === Customization ===
  customization:
    type: ["string", "null"]
    description: User-provided customization instructions (overrides defaults)

  # === Activation ===
  activation_extras:
    type: array
    items:
      type: object
      properties:
        after_step:
          type: [integer, string]
          description: Insert after this base step number or named step
        instructions:
          type: array
          items:
            type: string
    description: Additional activation instructions beyond base

  # === Commands ===
  commands:
    type: array
    items:
      oneOf:
        - type: object
          additionalProperties:
            oneOf:
              - type: string
              - type: object
        - type: string
    description: Agent-specific commands (added to common commands)

  # === Dependencies ===
  dependencies:
    type: object
    properties:
      checklists:
        type: array
        items:
          type: string
      tasks:
        type: array
        items:
          type: string
      templates:
        type: array
        items:
          type: string
      data:
        type: array
        items:
          type: string
    description: Files the agent depends on

  # === Inter-Agent Communication ===
  inter_agent:
    type: object
    properties:
      writes_to:
        type: string
        description: File path this agent writes notes to
      reads_from:
        type: array
        items:
          type: string
        description: Files this agent reads from
      handoff:
        type: array
        items:
          type: object
          required: ["agent", "purpose"]
          properties:
            agent:
              type: string
              description: Agent to hand off to (e.g., /qa)
            purpose:
              type: string
              description: Reason for handoff

  # === Story Permissions (for QA-like agents) ===
  story_permissions:
    type: object
    properties:
      allowed_sections:
        type: array
        items:
          type: string
        description: Sections this agent can modify in story files
      forbidden_sections:
        type: array
        items:
          type: string
        description: Sections this agent cannot modify

  # === Extended Documentation ===
  extended_docs:
    type: [string, object]
    description: Additional documentation â€” markdown string or structured object

  # === Platform Output Metadata ===
  platform_meta:
    type: object
    description: Platform-specific output configuration for multi-platform generation
    additionalProperties:
      type: object
      properties:
        description:
          type: string
          description: Short description shown in platform UI (frontmatter, rule description)
        allowed_tools:
          type: string
          description: Tool restrictions for Claude Code frontmatter (security agents only)
        pass_arguments:
          type: boolean
          description: Whether to include $ARGUMENTS placeholder in Claude output
          default: false

  # === Problem-Solving Mode ===
  problem_solving_mode:
    type: string
    enum: ["cautious", "rapid"]
    default: "cautious"
    description: Controls problem-solving behavior. cautious=analyze+confirm+implement (default), rapid=analyze+implement (for incident response)
