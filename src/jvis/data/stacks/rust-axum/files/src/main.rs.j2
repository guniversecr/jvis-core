//! {{ project_description }}

use std::net::SocketAddr;

use tracing_subscriber::EnvFilter;

mod api;
mod application;
mod domain;
mod infrastructure;

#[tokio::main]
async fn main() {
    dotenvy::dotenv().ok();

    tracing_subscriber::fmt()
        .with_env_filter(EnvFilter::try_from_default_env().unwrap_or_else(|_| "info".into()))
        .init();

    let config = infrastructure::config::Config::from_env();
    let pool = infrastructure::database::create_pool(&config.database_url).await;

    let app = api::routes::create_router().with_state(pool);

    let addr = SocketAddr::from(([0, 0, 0, 0], config.port));
    tracing::info!("{{ project_name }} listening on {}", addr);

    let listener = tokio::net::TcpListener::bind(addr).await.unwrap();
    axum::serve(listener, app).await.unwrap();
}
