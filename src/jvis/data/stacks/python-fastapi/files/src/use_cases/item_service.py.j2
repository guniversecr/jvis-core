"""Item service — business logic layer."""

{% if database_type in ("postgresql", "mysql") %}
import uuid

from fastapi import HTTPException

from src.domain.entities.item import Item
from src.infrastructure.repositories.item_repository import ItemRepository


class ItemService:
    def __init__(self, repository: ItemRepository) -> None:
        self._repo = repository

    async def create_item(self, name: str, description: str | None = None) -> Item:
        return await self._repo.create(name=name, description=description)

    async def get_item(self, item_id: uuid.UUID) -> Item:
        item = await self._repo.get(item_id)
        if item is None:
            raise HTTPException(status_code=404, detail="Item not found")
        return item

    async def list_items(self, offset: int = 0, limit: int = 100) -> list[Item]:
        return await self._repo.list(offset=offset, limit=limit)

    async def update_item(self, item_id: uuid.UUID, **fields: object) -> Item:
        item = await self.get_item(item_id)
        return await self._repo.update(item, **fields)

    async def delete_item(self, item_id: uuid.UUID) -> None:
        item = await self.get_item(item_id)
        await self._repo.delete(item)
{% else %}
# DynamoDB — implement service with boto3 repository.
{% endif %}
